# Streamlit Share 中文字体问题解决指南

本文档提供了在Streamlit Share上解决中文字体显示问题的详细说明。

## 问题描述

在Streamlit Share服务器上部署应用时，matplotlib绘图中的中文字符可能显示为方框或乱码。这是因为服务器环境中缺少中文字体。

## 解决方案

本项目已经实现了多种解决方案，按照以下步骤使用：

### 1. 使用项目内置的自动解决方案

本项目已包含自动解决中文字体问题的代码：

- `set_chinese_font()` 函数会自动尝试加载项目中包含的中文字体
- 如果字体加载失败，会自动提供英文标签选项

### 2. 手动下载并安装中文字体

如果您在本地开发环境中，可以运行以下命令来下载并安装中文字体：

```bash
python download_font.py
```

这将下载思源黑体（Source Han Sans）并将其安装到项目的fonts目录中。

### 3. 使用英文标签模式

如果中文字体仍然无法正常显示，应用程序提供了英文标签模式：

1. 在应用的侧边栏中找到"在图表中使用英文标签"复选框
2. 勾选此选项将使所有图表使用英文标签

## 部署到Streamlit Share时的注意事项

1. 确保`fonts`目录包含在您的Git仓库中（即使目录为空）
2. 确保`requirements.txt`中包含必要的依赖
3. 部署后，如果图表中的中文仍然显示为方框，请激活英文标签模式

## 技术细节

当应用在Streamlit Share上运行时，中文字体问题的解决方案按以下顺序工作：

1. 尝试加载项目目录中的TTF或OTF字体文件
2. 如果找不到字体文件，尝试使用系统字体（SimHei、Microsoft YaHei等）
3. 如果系统中也没有合适的中文字体，回退到英文字体并显示警告
4. 用户可以选择切换到英文标签模式，确保图表可读性

## 常见问题

### Q: 我仍然看到"Font family 'Source Han Sans CN' not found"警告

这个警告表示Matplotlib无法找到思源黑体字体。如果您看到此警告但图表中的中文显示正常，可以忽略它。如果中文显示为方框，请启用英文标签模式。

### Q: 如何在本地环境中解决中文字体问题？

在本地环境中，您可以安装系统级别的中文字体，或者运行`python download_font.py`下载项目专用字体。

## 其他解决方案

如果以上方法仍然无法解决问题，可以考虑：

1. 使用Plotly代替Matplotlib（Plotly的字体渲染通常更可靠）
2. 在图表生成前将所有中文标签转换为英文
3. 使用图片代替动态生成的图表

## 贡献

如果您发现了更好的解决方案，欢迎提交Pull Request或创建Issue。 